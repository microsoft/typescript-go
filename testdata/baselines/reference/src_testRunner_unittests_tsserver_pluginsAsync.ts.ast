SourceFile
  ImportDeclaration
    ImportClause
      NamespaceImport
        Identifier: ' ts'
    StringLiteral
  ImportDeclaration
    ImportClause
      NamedImports
        ImportSpecifier
          Identifier: '
    defer'
        ImportSpecifier
          Identifier: '
    Deferred'
    StringLiteral
  ImportDeclaration
    ImportClause
      NamedImports
        ImportSpecifier
          Identifier: '
    baselineTsserverLogs'
        ImportSpecifier
          Identifier: '
    closeFilesForSession'
        ImportSpecifier
          Identifier: '
    openFilesForSession'
        ImportSpecifier
          Identifier: '
    TestSession'
    StringLiteral
  ImportDeclaration
    ImportClause
      NamedImports
        ImportSpecifier
          Identifier: ' TestServerHost'
    StringLiteral
  ExpressionStatement
    CallExpression
      Identifier: '

describe'
      StringLiteral
      ArrowFunction
        EqualsGreaterThanToken
        Block
          FunctionDeclaration
            Identifier: ' setup'
            Parameter
              Identifier: 'globalPlugins'
              ArrayType
                StringKeyword
            Block
              VariableStatement
                VariableDeclarationList
                  VariableDeclaration
                    Identifier: ' host'
                    CallExpression
                      PropertyAccessExpression
                        Identifier: ' TestServerHost'
                        Identifier: 'createServerHost'
                      ArrayLiteralExpression
              VariableStatement
                VariableDeclarationList
                  VariableDeclaration
                    Identifier: ' session'
                    NewExpression
                      Identifier: ' TestSession'
                      ObjectLiteralExpression
                        ShorthandPropertyAssignment
                          Identifier: ' host'
                        ShorthandPropertyAssignment
                          Identifier: ' globalPlugins'
              ReturnStatement
                ObjectLiteralExpression
                  ShorthandPropertyAssignment
                    Identifier: ' host'
                  ShorthandPropertyAssignment
                    Identifier: ' session'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                AsyncKeyword
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        ObjectBindingPattern
                          BindingElement
                            Identifier: ' host'
                          BindingElement
                            Identifier: ' session'
                        CallExpression
                          Identifier: ' setup'
                          ArrayLiteralExpression
                            StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginModuleInstantiated'
                        FalseKeyword
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginInvoked'
                        FalseKeyword
                  ExpressionStatement
                    BinaryExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'importPlugin'
                      EqualsToken
                      ArrowFunction
                        AsyncKeyword
                        Parameter
                          Identifier: '_root'
                          StringKeyword
                        Parameter
                          Identifier: ' moduleName'
                          StringKeyword
                        TypeReference
                          Identifier: ' Promise'
                          TypeReference
                            QualifiedName
                              QualifiedName
                                Identifier: 'ts'
                                Identifier: 'server'
                              Identifier: 'ModuleImportResult'
                        EqualsGreaterThanToken
                        Block
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ExpressionStatement
                            AwaitExpression
                              CallExpression
                                PropertyAccessExpression
                                  Identifier: ' Promise'
                                  Identifier: 'resolve'
                          ExpressionStatement
                            BinaryExpression
                              Identifier: ' // simulate at least a single turn delay
            pluginModuleInstantiated'
                              EqualsToken
                              TrueKeyword
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ReturnStatement
                            ObjectLiteralExpression
                              PropertyAssignment
                                Identifier: '
                module'
                                AsExpression
                                  ParenthesizedExpression
                                    ArrowFunction
                                      EqualsGreaterThanToken
                                      Block
                                        ExpressionStatement
                                          BinaryExpression
                                            Identifier: '
                    pluginInvoked'
                                            EqualsToken
                                            TrueKeyword
                                        ReturnStatement
                                          ObjectLiteralExpression
                                            PropertyAssignment
                                              Identifier: ' create'
                                              ArrowFunction
                                                Parameter
                                                  Identifier: ' info'
                                                EqualsGreaterThanToken
                                                PropertyAccessExpression
                                                  Identifier: ' info'
                                                  Identifier: 'languageService'
                                  TypeReference
                                    QualifiedName
                                      QualifiedName
                                        Identifier: ' ts'
                                        Identifier: 'server'
                                      Identifier: 'PluginModuleFactory'
                              PropertyAssignment
                                Identifier: '
                error'
                                Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        openFilesForSession'
                      ArrayLiteralExpression
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: ' file'
                            StringLiteral
                          PropertyAssignment
                            Identifier: ' content'
                            StringLiteral
                      Identifier: ' session'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectService'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' session'
                            Identifier: 'getProjectService'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      NoSubstitutionTemplateLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          CallExpression
                            PropertyAccessExpression
                              Identifier: 'projectService'
                              Identifier: 'hasNewPluginEnablementRequests'
                          TemplateTail
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      NoSubstitutionTemplateLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          CallExpression
                            PropertyAccessExpression
                              Identifier: 'projectService'
                              Identifier: 'hasPendingPluginEnablements'
                          TemplateTail
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      NoSubstitutionTemplateLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          Identifier: 'pluginModuleInstantiated'
                          TemplateTail
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      NoSubstitutionTemplateLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          Identifier: 'pluginModuleInstantiated'
                          TemplateTail
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          Identifier: 'pluginInvoked'
                          TemplateTail
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        baselineTsserverLogs'
                      StringLiteral
                      StringLiteral
                      Identifier: ' session'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                AsyncKeyword
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        ObjectBindingPattern
                          BindingElement
                            Identifier: ' host'
                          BindingElement
                            Identifier: ' session'
                        CallExpression
                          Identifier: ' setup'
                          ArrayLiteralExpression
                            StringLiteral
                            StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginADeferred'
                        CallExpression
                          Identifier: ' defer'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginBDeferred'
                        CallExpression
                          Identifier: ' defer'
                  ExpressionStatement
                    BinaryExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'importPlugin'
                      EqualsToken
                      ArrowFunction
                        AsyncKeyword
                        Parameter
                          Identifier: '_root'
                          StringKeyword
                        Parameter
                          Identifier: ' moduleName'
                          StringKeyword
                        TypeReference
                          Identifier: ' Promise'
                          TypeReference
                            QualifiedName
                              QualifiedName
                                Identifier: 'ts'
                                Identifier: 'server'
                              Identifier: 'ModuleImportResult'
                        EqualsGreaterThanToken
                        Block
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          VariableStatement
                            VariableDeclarationList
                              VariableDeclaration
                                Identifier: ' promise'
                                ConditionalExpression
                                  BinaryExpression
                                    Identifier: ' moduleName'
                                    EqualsEqualsEqualsToken
                                    StringLiteral
                                  QuestionToken
                                  PropertyAccessExpression
                                    Identifier: ' pluginADeferred'
                                    Identifier: 'promise'
                                  ColonToken
                                  PropertyAccessExpression
                                    Identifier: ' pluginBDeferred'
                                    Identifier: 'promise'
                          ExpressionStatement
                            AwaitExpression
                              Identifier: ' promise'
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ReturnStatement
                            ObjectLiteralExpression
                              PropertyAssignment
                                Identifier: '
                module'
                                AsExpression
                                  ParenthesizedExpression
                                    ArrowFunction
                                      EqualsGreaterThanToken
                                      Block
                                        ExpressionStatement
                                          CallExpression
                                            PropertyAccessExpression
                                              PropertyAccessExpression
                                                Identifier: '
                    session'
                                                Identifier: 'logger'
                                              Identifier: 'log'
                                            TemplateExpression
                                              TemplateHead
                                              TemplateSpan
                                                Identifier: 'moduleName'
                                                TemplateTail
                                        ReturnStatement
                                          ObjectLiteralExpression
                                            PropertyAssignment
                                              Identifier: ' create'
                                              ArrowFunction
                                                Parameter
                                                  Identifier: ' info'
                                                EqualsGreaterThanToken
                                                PropertyAccessExpression
                                                  Identifier: ' info'
                                                  Identifier: 'languageService'
                                  TypeReference
                                    QualifiedName
                                      QualifiedName
                                        Identifier: ' ts'
                                        Identifier: 'server'
                                      Identifier: 'PluginModuleFactory'
                              PropertyAssignment
                                Identifier: '
                error'
                                Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        openFilesForSession'
                      ArrayLiteralExpression
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: ' file'
                            StringLiteral
                          PropertyAssignment
                            Identifier: ' content'
                            StringLiteral
                      Identifier: ' session'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectService'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' session'
                            Identifier: 'getProjectService'
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' Promise'
                          Identifier: 'resolve'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '

        // resolve imports out of order
        pluginBDeferred'
                        Identifier: 'resolve'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '
        pluginADeferred'
                        Identifier: 'resolve'
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        baselineTsserverLogs'
                      StringLiteral
                      StringLiteral
                      Identifier: ' session'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                AsyncKeyword
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        ObjectBindingPattern
                          BindingElement
                            Identifier: ' host'
                          BindingElement
                            Identifier: ' session'
                        CallExpression
                          Identifier: ' setup'
                          ArrayLiteralExpression
                            StringLiteral
                  ExpressionStatement
                    BinaryExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'importPlugin'
                      EqualsToken
                      ArrowFunction
                        AsyncKeyword
                        Parameter
                          Identifier: '_root'
                          StringKeyword
                        Parameter
                          Identifier: ' moduleName'
                          StringKeyword
                        TypeReference
                          Identifier: ' Promise'
                          TypeReference
                            QualifiedName
                              QualifiedName
                                Identifier: 'ts'
                                Identifier: 'server'
                              Identifier: 'ModuleImportResult'
                        EqualsGreaterThanToken
                        Block
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ExpressionStatement
                            AwaitExpression
                              CallExpression
                                PropertyAccessExpression
                                  Identifier: ' Promise'
                                  Identifier: 'resolve'
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: ' // simulate at least a single turn delay
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ReturnStatement
                            ObjectLiteralExpression
                              PropertyAssignment
                                Identifier: '
                module'
                                AsExpression
                                  ParenthesizedExpression
                                    ArrowFunction
                                      EqualsGreaterThanToken
                                      ParenthesizedExpression
                                        ObjectLiteralExpression
                                          PropertyAssignment
                                            Identifier: ' create'
                                            ArrowFunction
                                              Parameter
                                                Identifier: ' info'
                                              EqualsGreaterThanToken
                                              PropertyAccessExpression
                                                Identifier: ' info'
                                                Identifier: 'languageService'
                                  TypeReference
                                    QualifiedName
                                      QualifiedName
                                        Identifier: ' ts'
                                        Identifier: 'server'
                                      Identifier: 'PluginModuleFactory'
                              PropertyAssignment
                                Identifier: '
                error'
                                Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        openFilesForSession'
                      ArrayLiteralExpression
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: ' file'
                            StringLiteral
                          PropertyAssignment
                            Identifier: ' content'
                            StringLiteral
                      Identifier: ' session'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectService'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' session'
                            Identifier: 'getProjectService'
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        baselineTsserverLogs'
                      StringLiteral
                      StringLiteral
                      Identifier: ' session'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                AsyncKeyword
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        ObjectBindingPattern
                          BindingElement
                            Identifier: ' host'
                          BindingElement
                            Identifier: ' session'
                        CallExpression
                          Identifier: ' setup'
                          ArrayLiteralExpression
                            StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginAShouldLoad'
                        CallExpression
                          Identifier: ' defer'
                  ExpressionStatement
                    BinaryExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'importPlugin'
                      EqualsToken
                      ArrowFunction
                        AsyncKeyword
                        Parameter
                          Identifier: '_root'
                          StringKeyword
                        Parameter
                          Identifier: ' moduleName'
                          StringKeyword
                        TypeReference
                          Identifier: ' Promise'
                          TypeReference
                            QualifiedName
                              QualifiedName
                                Identifier: 'ts'
                                Identifier: 'server'
                              Identifier: 'ModuleImportResult'
                        EqualsGreaterThanToken
                        Block
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ExpressionStatement
                            AwaitExpression
                              PropertyAccessExpression
                                Identifier: ' pluginAShouldLoad'
                                Identifier: 'promise'
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ReturnStatement
                            ObjectLiteralExpression
                              PropertyAssignment
                                Identifier: '
                module'
                                AsExpression
                                  ParenthesizedExpression
                                    ArrowFunction
                                      EqualsGreaterThanToken
                                      ParenthesizedExpression
                                        ObjectLiteralExpression
                                          PropertyAssignment
                                            Identifier: '
                    create'
                                            ArrowFunction
                                              Parameter
                                                Identifier: ' info'
                                              EqualsGreaterThanToken
                                              PropertyAccessExpression
                                                Identifier: ' info'
                                                Identifier: 'languageService'
                                          PropertyAssignment
                                            Identifier: '
                    getExternalFiles'
                                            ArrowFunction
                                              EqualsGreaterThanToken
                                              ArrayLiteralExpression
                                                StringLiteral
                                  TypeReference
                                    QualifiedName
                                      QualifiedName
                                        Identifier: ' ts'
                                        Identifier: 'server'
                                      Identifier: 'PluginModuleFactory'
                              PropertyAssignment
                                Identifier: '
                error'
                                Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        openFilesForSession'
                      ArrayLiteralExpression
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: ' file'
                            StringLiteral
                          PropertyAssignment
                            Identifier: ' content'
                            StringLiteral
                      Identifier: ' session'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectService'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' session'
                            Identifier: 'getProjectService'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' project'
                        ElementAccessExpression
                          PropertyAccessExpression
                            Identifier: ' projectService'
                            Identifier: 'inferredProjects'
                          NumericLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          CallExpression
                            PropertyAccessExpression
                              CallExpression
                                PropertyAccessExpression
                                  Identifier: 'project'
                                  Identifier: 'getExternalFiles'
                              Identifier: 'join'
                            StringLiteral
                          TemplateTail
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '
        // we've ready the initial set of external files, allow the plugin to continue loading.
        pluginAShouldLoad'
                        Identifier: 'resolve'
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '

        host'
                        Identifier: 'runQueuedTimeoutCallbacks'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'logger'
                        Identifier: 'log'
                      TemplateExpression
                        TemplateHead
                        TemplateSpan
                          CallExpression
                            PropertyAccessExpression
                              CallExpression
                                PropertyAccessExpression
                                  Identifier: 'project'
                                  Identifier: 'getExternalFiles'
                              Identifier: 'join'
                            StringLiteral
                          TemplateTail
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        baselineTsserverLogs'
                      StringLiteral
                      StringLiteral
                      Identifier: ' session'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                AsyncKeyword
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        ObjectBindingPattern
                          BindingElement
                            Identifier: ' host'
                          BindingElement
                            Identifier: ' session'
                        CallExpression
                          Identifier: ' setup'
                          ArrayLiteralExpression
                            StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginALoaded'
                        CallExpression
                          Identifier: ' defer'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectClosed'
                        CallExpression
                          Identifier: ' defer'
                  ExpressionStatement
                    BinaryExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'importPlugin'
                      EqualsToken
                      ArrowFunction
                        AsyncKeyword
                        Parameter
                          Identifier: '_root'
                          StringKeyword
                        Parameter
                          Identifier: ' moduleName'
                          StringKeyword
                        TypeReference
                          Identifier: ' Promise'
                          TypeReference
                            QualifiedName
                              QualifiedName
                                Identifier: 'ts'
                                Identifier: 'server'
                              Identifier: 'ModuleImportResult'
                        EqualsGreaterThanToken
                        Block
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                Identifier: '
            // mark that the plugin has started loading
            pluginALoaded'
                                Identifier: 'resolve'
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '

            // wait until after a project close has been requested to continue
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              NoSubstitutionTemplateLiteral
                          ExpressionStatement
                            AwaitExpression
                              PropertyAccessExpression
                                Identifier: ' projectClosed'
                                Identifier: 'promise'
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '

            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ReturnStatement
                            ObjectLiteralExpression
                              PropertyAssignment
                                Identifier: '
                module'
                                AsExpression
                                  ParenthesizedExpression
                                    ArrowFunction
                                      EqualsGreaterThanToken
                                      ParenthesizedExpression
                                        ObjectLiteralExpression
                                          PropertyAssignment
                                            Identifier: ' create'
                                            ArrowFunction
                                              Parameter
                                                Identifier: ' info'
                                              EqualsGreaterThanToken
                                              PropertyAccessExpression
                                                Identifier: ' info'
                                                Identifier: 'languageService'
                                  TypeReference
                                    QualifiedName
                                      QualifiedName
                                        Identifier: ' ts'
                                        Identifier: 'server'
                                      Identifier: 'PluginModuleFactory'
                              PropertyAssignment
                                Identifier: '
                error'
                                Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        openFilesForSession'
                      ArrayLiteralExpression
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: ' file'
                            StringLiteral
                          PropertyAssignment
                            Identifier: ' content'
                            StringLiteral
                      Identifier: ' session'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectService'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' session'
                            Identifier: 'getProjectService'
                  ExpressionStatement
                    AwaitExpression
                      PropertyAccessExpression
                        Identifier: ' pluginALoaded'
                        Identifier: 'promise'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        // close the project
        closeFilesForSession'
                      ArrayLiteralExpression
                        StringLiteral
                      Identifier: ' session'
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        openFilesForSession'
                      ArrayLiteralExpression
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: ' file'
                            StringLiteral
                          PropertyAssignment
                            Identifier: ' content'
                            StringLiteral
                      Identifier: ' session'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '

        // continue loading the plugin
        projectClosed'
                        Identifier: 'resolve'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: ' // For closed foo.ts
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: ' // For random file
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        // the project was closed before plugins were ready. no project update should have been requested
        baselineTsserverLogs'
                      StringLiteral
                      StringLiteral
                      Identifier: ' session'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                AsyncKeyword
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' config'
                        StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' file'
                        StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' host'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' TestServerHost'
                            Identifier: 'createServerHost'
                          ObjectLiteralExpression
                            PropertyAssignment
                              ComputedPropertyName
                                Identifier: 'config'
                              NoSubstitutionTemplateLiteral
                            PropertyAssignment
                              ComputedPropertyName
                                Identifier: 'file'
                              StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' session'
                        NewExpression
                          Identifier: ' TestSession'
                          ObjectLiteralExpression
                            ShorthandPropertyAssignment
                              Identifier: ' host'
                            PropertyAssignment
                              Identifier: ' globalPlugins'
                              ArrayLiteralExpression
                                StringLiteral
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' pluginALoaded'
                        CallExpression
                          Identifier: ' defer'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' configFileDeleted'
                        UnionType
                          TypeReference
                            Identifier: ' Deferred'
                            VoidKeyword
                          UndefinedKeyword
                        CallExpression
                          Identifier: ' defer'
                  ExpressionStatement
                    BinaryExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'importPlugin'
                      EqualsToken
                      ArrowFunction
                        AsyncKeyword
                        Parameter
                          Identifier: '_root'
                          StringKeyword
                        Parameter
                          Identifier: ' moduleName'
                          StringKeyword
                        TypeReference
                          Identifier: ' Promise'
                          TypeReference
                            QualifiedName
                              QualifiedName
                                Identifier: 'ts'
                                Identifier: 'server'
                              Identifier: 'ModuleImportResult'
                        EqualsGreaterThanToken
                        Block
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                Identifier: '
            // mark that the plugin has started loading
            pluginALoaded'
                                Identifier: 'resolve'
                          IfStatement
                            Identifier: 'configFileDeleted'
                            Block
                              ExpressionStatement
                                CallExpression
                                  PropertyAccessExpression
                                    PropertyAccessExpression
                                      Identifier: '
                session'
                                      Identifier: 'logger'
                                    Identifier: 'log'
                                  NoSubstitutionTemplateLiteral
                              ExpressionStatement
                                AwaitExpression
                                  PropertyAccessExpression
                                    Identifier: ' configFileDeleted'
                                    Identifier: 'promise'
                          ExpressionStatement
                            CallExpression
                              PropertyAccessExpression
                                PropertyAccessExpression
                                  Identifier: '
            session'
                                  Identifier: 'logger'
                                Identifier: 'log'
                              TemplateExpression
                                TemplateHead
                                TemplateSpan
                                  Identifier: 'moduleName'
                                  TemplateTail
                          ReturnStatement
                            ObjectLiteralExpression
                              PropertyAssignment
                                Identifier: '
                module'
                                AsExpression
                                  ParenthesizedExpression
                                    ArrowFunction
                                      EqualsGreaterThanToken
                                      ParenthesizedExpression
                                        ObjectLiteralExpression
                                          PropertyAssignment
                                            Identifier: ' create'
                                            ArrowFunction
                                              Parameter
                                                Identifier: ' info'
                                              EqualsGreaterThanToken
                                              PropertyAccessExpression
                                                Identifier: ' info'
                                                Identifier: 'languageService'
                                  TypeReference
                                    QualifiedName
                                      QualifiedName
                                        Identifier: ' ts'
                                        Identifier: 'server'
                                      Identifier: 'PluginModuleFactory'
                              PropertyAssignment
                                Identifier: '
                error'
                                Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        openFilesForSession'
                      ArrayLiteralExpression
                        Identifier: 'file'
                      Identifier: ' session'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' projectService'
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' session'
                            Identifier: 'getProjectService'
                  ExpressionStatement
                    AwaitExpression
                      PropertyAccessExpression
                        Identifier: ' pluginALoaded'
                        Identifier: 'promise'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '

        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '
        // close the project
        host'
                        Identifier: 'deleteFile'
                      Identifier: 'config'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '

        // continue loading the plugin
        configFileDeleted'
                        Identifier: 'resolve'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    BinaryExpression
                      Identifier: '

        configFileDeleted'
                      EqualsToken
                      Identifier: ' undefined'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'writeFile'
                      Identifier: 'config'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '
        host'
                        Identifier: 'runQueuedTimeoutCallbacks'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        Identifier: '
        projectService'
                        Identifier: 'enableRequestedPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    AwaitExpression
                      CallExpression
                        PropertyAccessExpression
                          Identifier: ' projectService'
                          Identifier: 'waitForPendingPlugins'
                  ExpressionStatement
                    CallExpression
                      PropertyAccessExpression
                        PropertyAccessExpression
                          Identifier: '
        session'
                          Identifier: 'host'
                        Identifier: 'baselineHost'
                      StringLiteral
                  ExpressionStatement
                    CallExpression
                      Identifier: '

        // the project was closed before plugins were ready. no project update should have been requested
        baselineTsserverLogs'
                      StringLiteral
                      StringLiteral
                      Identifier: ' session'
