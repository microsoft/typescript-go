SourceFile
  TypeAliasDeclaration
    Identifier: ' Either'
    TypeParameter
      Identifier: 'E'
    TypeParameter
      Identifier: ' A'
    UnionType
      TypeReference
        Identifier: ' Left'
        TypeReference
          Identifier: 'E'
      TypeReference
        Identifier: ' Right'
        TypeReference
          Identifier: 'A'
  TypeAliasDeclaration
    Identifier: ' Left'
    TypeParameter
      Identifier: 'E'
    TypeLiteral
      PropertySignature
        Identifier: ' tag'
        LiteralType
          StringLiteral
      PropertySignature
        Identifier: ' e'
        TypeReference
          Identifier: ' E'
  TypeAliasDeclaration
    Identifier: ' Right'
    TypeParameter
      Identifier: 'A'
    TypeLiteral
      PropertySignature
        Identifier: ' tag'
        LiteralType
          StringLiteral
      PropertySignature
        Identifier: ' a'
        TypeReference
          Identifier: ' A'
  VariableStatement
    VariableDeclarationList
      VariableDeclaration
        Identifier: ' mkLeft'
        ArrowFunction
          TypeParameter
            Identifier: 'E'
          Parameter
            Identifier: 'e'
            TypeReference
              Identifier: ' E'
          TypeReference
            Identifier: ' Either'
            TypeReference
              Identifier: 'E'
            NeverKeyword
          EqualsGreaterThanToken
          ParenthesizedExpression
            ObjectLiteralExpression
              PropertyAssignment
                Identifier: ' tag'
                StringLiteral
              ShorthandPropertyAssignment
                Identifier: ' e'
  VariableStatement
    VariableDeclarationList
      VariableDeclaration
        Identifier: ' mkRight'
        ArrowFunction
          TypeParameter
            Identifier: 'A'
          Parameter
            Identifier: 'a'
            TypeReference
              Identifier: ' A'
          TypeReference
            Identifier: ' Either'
            NeverKeyword
            TypeReference
              Identifier: ' A'
          EqualsGreaterThanToken
          ParenthesizedExpression
            ObjectLiteralExpression
              PropertyAssignment
                Identifier: ' tag'
                StringLiteral
              ShorthandPropertyAssignment
                Identifier: ' a'
  ClassDeclaration
    Identifier: ' EPromise'
    TypeParameter
      Identifier: 'E'
    TypeParameter
      Identifier: ' A'
    HeritageClause
      ExpressionWithTypeArguments
        Identifier: ' PromiseLike'
        TypeReference
          Identifier: 'A'
    MethodDeclaration
      StaticKeyword
      Identifier: ' succeed'
      TypeParameter
        Identifier: 'A'
      Parameter
        Identifier: 'a'
        TypeReference
          Identifier: ' A'
      TypeReference
        Identifier: ' EPromise'
        NeverKeyword
        TypeReference
          Identifier: ' A'
      Block
        ReturnStatement
          NewExpression
            Identifier: ' EPromise'
            CallExpression
              PropertyAccessExpression
                Identifier: 'Promise'
                Identifier: 'resolve'
              CallExpression
                Identifier: 'mkRight'
                Identifier: 'a'
    MethodDeclaration
      StaticKeyword
      Identifier: ' fail'
      TypeParameter
        Identifier: 'E'
      Parameter
        Identifier: 'e'
        TypeReference
          Identifier: ' E'
      TypeReference
        Identifier: ' EPromise'
        TypeReference
          Identifier: 'E'
        NeverKeyword
      Block
        ReturnStatement
          NewExpression
            Identifier: ' EPromise'
            CallExpression
              PropertyAccessExpression
                Identifier: 'Promise'
                Identifier: 'resolve'
              CallExpression
                Identifier: 'mkLeft'
                Identifier: 'e'
    Constructor
      Parameter
        ReadonlyKeyword
        Identifier: ' p'
        TypeReference
          Identifier: ' PromiseLike'
          TypeReference
            Identifier: 'Either'
            TypeReference
              Identifier: 'E'
            TypeReference
              Identifier: ' A'
      Block
    MethodDeclaration
      Identifier: '

    then'
      TypeParameter
        Identifier: 'B'
        TypeReference
          Identifier: ' A'
      TypeParameter
        Identifier: ' B1'
        NeverKeyword
      Parameter
        Identifier: '
        // EPromise can act as a Thenable only when `E` is `never`.
        this'
        TypeReference
          Identifier: ' EPromise'
          NeverKeyword
          TypeReference
            Identifier: ' A'
      Parameter
        Identifier: '
        onfulfilled'
        QuestionToken
        UnionType
          ParenthesizedType
            FunctionType
              Parameter
                Identifier: 'value'
                TypeReference
                  Identifier: ' A'
              UnionType
                TypeReference
                  Identifier: ' B'
                TypeReference
                  Identifier: ' PromiseLike'
                  TypeReference
                    Identifier: 'B'
          LiteralType
            NullKeyword
          UndefinedKeyword
      Parameter
        Identifier: '
        onrejected'
        QuestionToken
        UnionType
          ParenthesizedType
            FunctionType
              Parameter
                Identifier: 'reason'
                AnyKeyword
              UnionType
                TypeReference
                  Identifier: ' B1'
                TypeReference
                  Identifier: ' PromiseLike'
                  TypeReference
                    Identifier: 'B1'
          LiteralType
            NullKeyword
          UndefinedKeyword
      TypeReference
        Identifier: ' PromiseLike'
        UnionType
          TypeReference
            Identifier: 'B'
          TypeReference
            Identifier: ' B1'
      Block
        ReturnStatement
          CallExpression
            PropertyAccessExpression
              PropertyAccessExpression
                ThisKeyword
                Identifier: 'p'
              Identifier: 'then'
            ArrowFunction
              Parameter
                Identifier: '
            // Casting to `Right<A>` is safe here because we've eliminated the possibility of `Left<E>`.
            either'
              EqualsGreaterThanToken
              BinaryExpression
                CallExpression
                  Identifier: ' onfulfilled'
                  QuestionDotToken
                  PropertyAccessExpression
                    ParenthesizedExpression
                      AsExpression
                        Identifier: 'either'
                        TypeReference
                          Identifier: ' Right'
                          TypeReference
                            Identifier: 'A'
                    Identifier: 'a'
                QuestionQuestionToken
                AsExpression
                  AsExpression
                    PropertyAccessExpression
                      ParenthesizedExpression
                        AsExpression
                          Identifier: 'either'
                          TypeReference
                            Identifier: ' Right'
                            TypeReference
                              Identifier: 'A'
                      Identifier: 'a'
                    UnknownKeyword
                  TypeReference
                    Identifier: ' B'
            Identifier: '
            onrejected'
  VariableStatement
    VariableDeclarationList
      VariableDeclaration
        Identifier: ' withTypedFailure'
        TypeReference
          Identifier: ' EPromise'
          NumberKeyword
          StringKeyword
        CallExpression
          PropertyAccessExpression
            Identifier: ' EPromise'
            Identifier: 'fail'
          NumericLiteral
  ExpressionStatement
    CallExpression
      PropertyAccessExpression
        CallExpression
          PropertyAccessExpression
            Identifier: '

// Errors as expected:
//
// "The 'this' context of type 'EPromise<number, string>' is not assignable to method's
//     'this' of type 'EPromise<never, string>"
withTypedFailure'
            Identifier: 'then'
          ArrowFunction
            Parameter
              Identifier: 's'
            EqualsGreaterThanToken
            CallExpression
              PropertyAccessExpression
                Identifier: ' s'
                Identifier: 'toUpperCase'
        Identifier: 'then'
      PropertyAccessExpression
        Identifier: 'console'
        Identifier: 'log'
  FunctionDeclaration
    AsyncKeyword
    Identifier: ' test'
    Block
      ExpressionStatement
        AwaitExpression
          Identifier: ' withTypedFailure'
