SourceFile
  ImportDeclaration
    ImportClause
      NamespaceImport
        Identifier: ' Harness'
    StringLiteral
  ImportDeclaration
    ImportClause
      NamespaceImport
        Identifier: ' ts'
    StringLiteral
  ExpressionStatement
    CallExpression
      Identifier: '

describe'
      StringLiteral
      ArrowFunction
        EqualsGreaterThanToken
        Block
          VariableStatement
            VariableDeclarationList
              VariableDeclaration
                Identifier: ' file'
                NoSubstitutionTemplateLiteral
          ExpressionStatement
            CallExpression
              Identifier: '
    it'
              StringLiteral
              ArrowFunction
                EqualsGreaterThanToken
                Block
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        verifyOperationCancelledAfter'
                      Identifier: 'file'
                      NumericLiteral
                      ArrowFunction
                        Parameter
                          Identifier: ' service'
                        EqualsGreaterThanToken
                        NonNullExpression
                          CallExpression
                            PropertyAccessExpression
                              Identifier: '
            // Two calls are top-level in services, one is the root type, and the second should be for the parameter type
            service'
                              Identifier: 'getSignatureHelpItems'
                            StringLiteral
                            CallExpression
                              PropertyAccessExpression
                                Identifier: ' file'
                                Identifier: 'lastIndexOf'
                              StringLiteral
                            PropertyAccessExpression
                              Identifier: ' ts'
                              Identifier: 'emptyOptions'
                      ArrowFunction
                        Parameter
                          Identifier: ' r'
                        EqualsGreaterThanToken
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' assert'
                            Identifier: 'exists'
                          ElementAccessExpression
                            PropertyAccessExpression
                              Identifier: 'r'
                              Identifier: 'items'
                            NumericLiteral
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                EqualsGreaterThanToken
                Block
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        verifyOperationCancelledAfter'
                      Identifier: 'file'
                      NumericLiteral
                      ArrowFunction
                        Parameter
                          Identifier: ' service'
                        EqualsGreaterThanToken
                        NonNullExpression
                          CallExpression
                            PropertyAccessExpression
                              Identifier: '
            // Two calls are top-level in services, one is the root type
            service'
                              Identifier: 'findReferences'
                            StringLiteral
                            CallExpression
                              PropertyAccessExpression
                                Identifier: ' file'
                                Identifier: 'lastIndexOf'
                              StringLiteral
                      ArrowFunction
                        Parameter
                          Identifier: ' r'
                        EqualsGreaterThanToken
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' assert'
                            Identifier: 'exists'
                          PropertyAccessExpression
                            ElementAccessExpression
                              Identifier: 'r'
                              NumericLiteral
                            Identifier: 'definition'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                EqualsGreaterThanToken
                Block
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        verifyOperationCancelledAfter'
                      Identifier: 'file'
                      NumericLiteral
                      ArrowFunction
                        Parameter
                          Identifier: ' service'
                        EqualsGreaterThanToken
                        NonNullExpression
                          CallExpression
                            PropertyAccessExpression
                              Identifier: '
            // The LS doesn't do any top-level checks on the token for quickinfo, so the first check is within the checker
            service'
                              Identifier: 'getQuickInfoAtPosition'
                            StringLiteral
                            CallExpression
                              PropertyAccessExpression
                                Identifier: ' file'
                                Identifier: 'lastIndexOf'
                              StringLiteral
                      ArrowFunction
                        Parameter
                          Identifier: ' r'
                        EqualsGreaterThanToken
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' assert'
                            Identifier: 'exists'
                          PropertyAccessExpression
                            Identifier: 'r'
                            Identifier: 'displayParts'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                EqualsGreaterThanToken
                Block
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' options'
                        TypeReference
                          QualifiedName
                            Identifier: ' ts'
                            Identifier: 'FormatCodeSettings'
                        ObjectLiteralExpression
                          PropertyAssignment
                            Identifier: '
            indentSize'
                            NumericLiteral
                          PropertyAssignment
                            Identifier: '
            tabSize'
                            NumericLiteral
                          PropertyAssignment
                            Identifier: '
            newLineCharacter'
                            StringLiteral
                          PropertyAssignment
                            Identifier: '
            convertTabsToSpaces'
                            TrueKeyword
                          PropertyAssignment
                            Identifier: '
            indentStyle'
                            PropertyAccessExpression
                              PropertyAccessExpression
                                Identifier: ' ts'
                                Identifier: 'IndentStyle'
                              Identifier: 'Smart'
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterConstructor'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterCommaDelimiter'
                            TrueKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterSemicolonInForStatements'
                            TrueKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceBeforeAndAfterBinaryOperators'
                            TrueKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterKeywordsInControlFlowStatements'
                            TrueKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterFunctionKeywordForAnonymousFunctions'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterOpeningAndBeforeClosingNonemptyParenthesis'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterOpeningAndBeforeClosingNonemptyBrackets'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterOpeningAndBeforeClosingNonemptyBraces'
                            TrueKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterOpeningAndBeforeClosingTemplateStringBraces'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceAfterOpeningAndBeforeClosingJsxExpressionBraces'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            insertSpaceBeforeFunctionParenthesis'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            placeOpenBraceOnNewLineForFunctions'
                            FalseKeyword
                          PropertyAssignment
                            Identifier: '
            placeOpenBraceOnNewLineForControlBlocks'
                            FalseKeyword
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        verifyOperationCancelledAfter'
                      Identifier: 'file'
                      NumericLiteral
                      ArrowFunction
                        Parameter
                          Identifier: ' service'
                        EqualsGreaterThanToken
                        NonNullExpression
                          CallExpression
                            PropertyAccessExpression
                              Identifier: '
            // The LS doesn't do any top-level checks on the token for completion entry details, so the first check is within the checker
            service'
                              Identifier: 'getCompletionEntryDetails'
                            StringLiteral
                            CallExpression
                              PropertyAccessExpression
                                Identifier: ' file'
                                Identifier: 'lastIndexOf'
                              StringLiteral
                            StringLiteral
                            Identifier: ' options'
                            Identifier: ' /*source*/ undefined'
                            ObjectLiteralExpression
                            Identifier: ' /*data*/ undefined'
                      ArrowFunction
                        Parameter
                          Identifier: ' r'
                        EqualsGreaterThanToken
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' assert'
                            Identifier: 'exists'
                          PropertyAccessExpression
                            Identifier: 'r'
                            Identifier: 'displayParts'
          ExpressionStatement
            CallExpression
              Identifier: '

    it'
              StringLiteral
              ArrowFunction
                EqualsGreaterThanToken
                Block
                  ExpressionStatement
                    CallExpression
                      Identifier: '
        verifyOperationCancelledAfter'
                      Identifier: '
            file'
                      NumericLiteral
                      ArrowFunction
                        Parameter
                          Identifier: '
            service'
                        EqualsGreaterThanToken
                        CallExpression
                          PropertyAccessExpression
                            Identifier: '
                // The LS doesn't do any top-level checks on the token for suggestion diagnostics, so the first check is within the checker
                service'
                            Identifier: 'getSuggestionDiagnostics'
                          StringLiteral
                      ArrowFunction
                        Parameter
                          Identifier: '
            r'
                        EqualsGreaterThanToken
                        CallExpression
                          PropertyAccessExpression
                            Identifier: ' assert'
                            Identifier: 'notEqual'
                          PropertyAccessExpression
                            Identifier: 'r'
                            Identifier: 'length'
                          NumericLiteral
                      StringLiteral
                      StringLiteral
                      ObjectLiteralExpression
                        PropertyAssignment
                          Identifier: ' allowJs'
                          TrueKeyword
  FunctionDeclaration
    Identifier: ' verifyOperationCancelledAfter'
    TypeParameter
      Identifier: 'T'
    Parameter
      Identifier: 'content'
      StringKeyword
    Parameter
      Identifier: ' cancelAfter'
      NumberKeyword
    Parameter
      Identifier: ' operation'
      FunctionType
        Parameter
          Identifier: 'service'
          TypeReference
            QualifiedName
              Identifier: ' ts'
              Identifier: 'LanguageService'
        TypeReference
          Identifier: ' T'
    Parameter
      Identifier: ' validator'
      FunctionType
        Parameter
          Identifier: 'arg'
          TypeReference
            Identifier: ' T'
        VoidKeyword
    Parameter
      Identifier: ' fileName'
      QuestionToken
      StringKeyword
    Parameter
      Identifier: ' fileContent'
      QuestionToken
      StringKeyword
    Parameter
      Identifier: ' options'
      QuestionToken
      TypeReference
        QualifiedName
          Identifier: ' ts'
          Identifier: 'CompilerOptions'
    Block
      VariableStatement
        VariableDeclarationList
          VariableDeclaration
            Identifier: ' checks'
            NumericLiteral
      VariableStatement
        VariableDeclarationList
          VariableDeclaration
            Identifier: ' token'
            TypeReference
              QualifiedName
                Identifier: ' ts'
                Identifier: 'HostCancellationToken'
            ObjectLiteralExpression
              MethodDeclaration
                Identifier: '
        isCancellationRequested'
                Block
                  ExpressionStatement
                    PostfixUnaryExpression
                      Identifier: '
            checks'
                  VariableStatement
                    VariableDeclarationList
                      VariableDeclaration
                        Identifier: ' result'
                        BinaryExpression
                          Identifier: ' checks'
                          GreaterThanEqualsToken
                          Identifier: ' cancelAfter'
                  IfStatement
                    Identifier: 'result'
                    Block
                      ExpressionStatement
                        BinaryExpression
                          Identifier: '
                checks'
                          EqualsToken
                          PrefixUnaryExpression
                            Identifier: 'Infinity'
                  ReturnStatement
                    Identifier: ' result'
      VariableStatement
        VariableDeclarationList
          VariableDeclaration
            Identifier: ' adapter'
            NewExpression
              PropertyAccessExpression
                PropertyAccessExpression
                  Identifier: ' Harness'
                  Identifier: 'LanguageService'
                Identifier: 'NativeLanguageServiceAdapter'
              Identifier: 'token'
              Identifier: ' options'
      VariableStatement
        VariableDeclarationList
          VariableDeclaration
            Identifier: ' host'
            CallExpression
              PropertyAccessExpression
                Identifier: ' adapter'
                Identifier: 'getHost'
      ExpressionStatement
        CallExpression
          PropertyAccessExpression
            Identifier: '
    host'
            Identifier: 'addScript'
          BinaryExpression
            Identifier: 'fileName'
            BarBarToken
            StringLiteral
          BinaryExpression
            Identifier: ' fileContent'
            BarBarToken
            Identifier: ' content'
          TrueKeyword
      VariableStatement
        VariableDeclarationList
          VariableDeclaration
            Identifier: ' service'
            CallExpression
              PropertyAccessExpression
                Identifier: ' adapter'
                Identifier: 'getLanguageService'
      ExpressionStatement
        CallExpression
          Identifier: '
    assertCancelled'
          ArrowFunction
            EqualsGreaterThanToken
            CallExpression
              Identifier: ' operation'
              Identifier: 'service'
      ExpressionStatement
        CallExpression
          Identifier: '
    validator'
          CallExpression
            Identifier: 'operation'
            Identifier: 'service'
  FunctionDeclaration
    Identifier: ' assertCancelled'
    Parameter
      Identifier: 'cb'
      FunctionType
        VoidKeyword
    Block
      VariableStatement
        VariableDeclarationList
          VariableDeclaration
            Identifier: ' caught'
            AnyKeyword
      TryStatement
        Block
          ExpressionStatement
            CallExpression
              Identifier: '
        cb'
        CatchClause
          VariableDeclaration
            Identifier: 'e'
          Block
            ExpressionStatement
              BinaryExpression
                Identifier: '
        caught'
                EqualsToken
                Identifier: ' e'
      ExpressionStatement
        CallExpression
          PropertyAccessExpression
            Identifier: '
    assert'
            Identifier: 'exists'
          Identifier: 'caught'
          StringLiteral
      ExpressionStatement
        CallExpression
          PropertyAccessExpression
            Identifier: '
    assert'
            Identifier: 'instanceOf'
          Identifier: 'caught'
          PropertyAccessExpression
            Identifier: ' ts'
            Identifier: 'OperationCanceledException'
